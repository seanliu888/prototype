<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <title>录入提现</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../chrome-compatibility.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f7fa;
        }
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(180deg, #1e3c72 0%, #2a5298 100%);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 12px 20px;
            margin: 5px 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: #fff;
            background-color: rgba(255,255,255,0.15);
        }
        .sidebar .nav-link i {
            margin-right: 10px;
            font-size: 1.1em;
        }
        .nav-section-title {
            color: rgba(255,255,255,0.5);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 15px 20px 8px 20px;
            margin-top: 10px;
        }
        .main-content {
            padding: 30px;
        }
        .page-header {
            background: white;
            padding: 25px 30px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .page-header h1 {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }
        .content-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .brand-logo {
            padding: 25px 20px;
            color: white;
            font-size: 20px;
            font-weight: 700;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        .form-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        .amount-preview {
            font-size: 36px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }
        .amount-cny { color: #e74c3c; }
        .amount-usd { color: #27ae60; }
        .amount-jpy { color: #3498db; }
        .amount-eur { color: #9b59b6; }
        .channel-option {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .channel-option:hover {
            border-color: #3498db;
        }
        .channel-option.selected {
            border-color: #3498db;
            background: #e8f4fd;
        }
        .channel-option i {
            font-size: 32px;
            margin-bottom: 8px;
        }
        .channel-alipay i { color: #1677ff; }
        .channel-wechat i { color: #07c160; }
        .channel-bank i { color: #fa8c16; }
        .channel-paypal i { color: #003087; }
        .distributor-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #3498db;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-2 px-0 sidebar">
                <div class="brand-logo">
                    <i class="bi bi-ticket-perforated-fill me-2"></i>
                    eSIMtours管理系统
                </div>
                <nav class="nav flex-column">
                    <a class="nav-link" href="../index.html">
                        <i class="bi bi-house-door-fill"></i>首页概览
                    </a>
                    
                    <div class="nav-section-title">模板配置</div>
                    <a class="nav-link" href="../coupon/template-list.html">
                        <i class="bi bi-file-earmark-text"></i>优惠券模板
                    </a>
                    
                    <div class="nav-section-title">发券管理</div>
                    <a class="nav-link" href="../coupon/coupon-list.html">
                        <i class="bi bi-ticket-detailed"></i>优惠码管理
                    </a>
                    <a class="nav-link" href="../coupon/batch-list.html">
                        <i class="bi bi-layers"></i>批次管理
                    </a>
                    <a class="nav-link" href="../coupon/marketing-activity-list.html">
                        <i class="bi bi-megaphone"></i>营销活动
                    </a>
                    
                    <div class="nav-section-title">分销商管理</div>
                    <a class="nav-link" href="distributor-list.html">
                        <i class="bi bi-shop"></i>分销商列表
                    </a>
                    <a class="nav-link" href="salesman-list.html">
                        <i class="bi bi-people"></i>业务员管理
                    </a>
                    <a class="nav-link active" href="withdrawal-list.html">
                        <i class="bi bi-cash-stack"></i>分销商提现
                    </a>
                    
                    <div class="nav-section-title">数据分析</div>
                    <a class="nav-link" href="../usage-log.html">
                        <i class="bi bi-clock-history"></i>使用记录
                    </a>
                    <a class="nav-link" href="../statistics.html">
                        <i class="bi bi-bar-chart-fill"></i>数据统计
                    </a>
                    <a class="nav-link" href="../operation-log.html">
                        <i class="bi bi-journal-text"></i>操作日志
                    </a>
                    
                    <div class="nav-section-title">系统管理</div>
                    <a class="nav-link" href="../dictionary/dict-type-list.html">
                        <i class="bi bi-book"></i>数据字典
                    </a>
                    
                    <div class="nav-section-title">帮助</div>
                    <a class="nav-link" href="../help.html">
                        <i class="bi bi-question-circle-fill"></i>使用说明
                    </a>
                </nav>
            </div>

            <!-- 主内容区 -->
            <div class="col-md-10 main-content">
                <div class="page-header d-flex justify-content-between align-items-center">
                    <div>
                        <h1><i class="bi bi-cash-stack me-2"></i>创建提现申请</h1>
                        <small class="text-muted">为分销商或业务员创建提现申请，提交后将立即触发返现操作</small>
                    </div>
                    <button class="btn btn-outline-secondary" onclick="window.location.href='withdrawal-list.html'">
                        <i class="bi bi-arrow-left me-1"></i>返回列表
                    </button>
                </div>

                <form id="withdrawalForm" onsubmit="return submitForm(event)">
                    <div class="row">
                        <div class="col-md-8">
                            <!-- 提现对象 -->
                            <div class="content-card">
                                <h5 class="form-section-title">
                                    <i class="bi bi-person-badge me-2"></i>提现对象
                                </h5>
                                
                                <div class="mb-4">
                                    <label class="form-label mb-3"><span class="text-danger">*</span> 对象类型</label>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-check form-check-inline p-3 border rounded h-100" style="cursor: pointer;" onclick="selectType('DISTRIBUTOR')">
                                                <input class="form-check-input" type="radio" name="withdrawalType" id="typeDistributor" value="DISTRIBUTOR" checked onchange="switchType()">
                                                <label class="form-check-label ms-2 w-100" for="typeDistributor" style="cursor: pointer;">
                                                    <div class="d-flex align-items-center">
                                                        <i class="bi bi-shop me-2" style="font-size: 24px; color: #3498db;"></i>
                                                        <div>
                                                            <strong>分销商</strong>
                                                            <div class="small text-muted">为分销商创建提现申请</div>
                                                        </div>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check form-check-inline p-3 border rounded h-100" style="cursor: pointer;" onclick="selectType('SALESMAN')">
                                                <input class="form-check-input" type="radio" name="withdrawalType" id="typeSalesman" value="SALESMAN" onchange="switchType()">
                                                <label class="form-check-label ms-2 w-100" for="typeSalesman" style="cursor: pointer;">
                                                    <div class="d-flex align-items-center">
                                                        <i class="bi bi-people me-2" style="font-size: 24px; color: #27ae60;"></i>
                                                        <div>
                                                            <strong>业务员</strong>
                                                            <div class="small text-muted">为业务员创建提现申请</div>
                                                        </div>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 分销商筛选（仅业务员类型时显示） -->
                                <div class="mb-3" id="distributorFilterDiv" style="display: none;">
                                    <label class="form-label"><span class="text-danger">*</span> 所属分销商</label>
                                    <select class="form-select" id="distributorFilter" required onchange="filterSalesmen()">
                                        <option value="">请选择分销商</option>
                                    </select>
                                    <div class="form-text">选择分销商后，下方将显示该分销商下的业务员</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label"><span class="text-danger">*</span> <span id="selectLabel">选择对象</span></label>
                                    <select class="form-select form-select-lg" id="targetSelect" required onchange="updateTargetInfo()">
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                                
                                <div class="distributor-info" id="targetInfo" style="display: none;">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <small class="text-muted d-block mb-1"><span id="infoNameLabel">对象名称</span></small>
                                            <div class="fw-bold fs-6" id="infoName">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted d-block mb-1">联系邮箱</small>
                                            <div id="infoEmail">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted d-block mb-1">可提现金额</small>
                                            <div class="fw-bold text-primary fs-5" id="infoWithdrawable">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted d-block mb-1">待结算金额</small>
                                            <div class="fw-bold text-success fs-5" id="infoBalance">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 提现信息 -->
                            <div class="content-card">
                                <h5 class="form-section-title">
                                    <i class="bi bi-wallet2 me-2"></i>提现信息
                                </h5>
                                
                                <div class="row g-3 mb-4">
                                    <div class="col-md-6">
                                        <label class="form-label"><span class="text-danger">*</span> 提现金额</label>
                                        <div class="input-group input-group-lg">
                                            <span class="input-group-text bg-light">$</span>
                                            <input type="number" class="form-control" id="amount" placeholder="0.00" step="0.01" min="0.01" required oninput="updateAmountPreview()">
                                        </div>
                                        <div class="form-text">货币类型：USD（美元）</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">货币类型</label>
                                        <input type="text" class="form-control form-control-lg bg-light" value="USD - 美元" readonly>
                                        <input type="hidden" id="currency" value="USD">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label"><span class="text-danger">*</span> 提现渠道</label>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="channel-option channel-alipay" onclick="selectChannel('ALIPAY', this)">
                                                <i class="bi bi-alipay d-block"></i>
                                                <strong>支付宝</strong>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="channel-option channel-wechat" onclick="selectChannel('WECHAT', this)">
                                                <i class="bi bi-wechat d-block"></i>
                                                <strong>微信</strong>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="channel-option channel-bank" onclick="selectChannel('BANK', this)">
                                                <i class="bi bi-bank d-block"></i>
                                                <strong>银行转账</strong>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="channel-option channel-paypal" onclick="selectChannel('PAYPAL', this)">
                                                <i class="bi bi-paypal d-block"></i>
                                                <strong>PayPal</strong>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="hidden" id="channel" required>
                                </div>
                                
                                <div class="mb-0">
                                    <label class="form-label"><span class="text-danger">*</span> 收款账号</label>
                                    <input type="text" class="form-control" id="accountNumber" placeholder="请输入收款账号（邮箱/手机号/银行卡号）" required>
                                    <div class="form-text">根据所选渠道填写对应的收款账号信息</div>
                                </div>
                            </div>

                            <!-- 备注说明 -->
                            <div class="content-card">
                                <h5 class="form-section-title">
                                    <i class="bi bi-chat-left-text me-2"></i>备注说明
                                </h5>
                                
                                <div class="mb-0">
                                    <label class="form-label">备注</label>
                                    <textarea class="form-control" id="remark" rows="3" placeholder="可填写结算周期、备注说明等信息（选填）"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <!-- 金额预览 -->
                            <div class="content-card text-center mb-3">
                                <h6 class="text-muted mb-3">提现金额</h6>
                                <div class="amount-preview" id="amountPreview">
                                    <span class="text-muted">$0.00</span>
                                </div>
                                <small class="text-muted" id="currencyLabel">USD（美元）</small>
                            </div>

                            <!-- 操作 -->
                            <div class="content-card">
                                <h5 class="form-section-title">
                                    <i class="bi bi-send me-2"></i>提交申请
                                </h5>
                                
                                <div class="alert alert-info mb-3">
                                    <small>
                                        <i class="bi bi-info-circle me-1"></i>
                                        提交前请确认：
                                        <ul class="mb-0 mt-2 small">
                                            <li id="confirmTypeInfo">提现对象信息正确</li>
                                            <li>提现渠道已选择</li>
                                            <li>金额核对无误</li>
                                            <li>收款账号正确</li>
                                        </ul>
                                    </small>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="bi bi-send me-2"></i>提交申请
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="window.location.href='withdrawal-list.html'">
                                        <i class="bi bi-x-circle me-2"></i>取消
                                    </button>
                                </div>
                            </div>

                            <!-- 最近提现 -->
                            <div class="content-card">
                                <h6 class="text-muted mb-3">
                                    <i class="bi bi-clock-history me-2"></i>最近提现记录
                                </h6>
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item px-0">
                                        <div class="d-flex justify-content-between">
                                            <small>张明远</small>
                                            <small class="text-success fw-bold">¥12,580</small>
                                        </div>
                                        <small class="text-muted">2025-12-15 10:30</small>
                                    </div>
                                    <div class="list-group-item px-0">
                                        <div class="d-flex justify-content-between">
                                            <small>李婷婷</small>
                                            <small class="text-success fw-bold">$2,350</small>
                                        </div>
                                        <small class="text-muted">2025-12-14 16:45</small>
                                    </div>
                                    <div class="list-group-item px-0">
                                        <div class="d-flex justify-content-between">
                                            <small>王大伟</small>
                                            <small class="text-success fw-bold">¥186,500</small>
                                        </div>
                                        <small class="text-muted">2025-12-14 11:20</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 预览确认模态框 -->
    <div class="modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="bi bi-eye me-2"></i>提现申请预览</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning mb-4">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <div>
                            <strong>重要提示：</strong>提交后将立即触发返现操作，请仔细核对以下信息，确认无误后再提交。
                        </div>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="text-muted small">提现对象类型</label>
                            <div class="fw-bold" id="previewType">-</div>
                        </div>
                        <div class="col-md-6">
                            <label class="text-muted small">提现对象</label>
                            <div class="fw-bold" id="previewTarget">-</div>
                        </div>
                        <div class="col-md-6">
                            <label class="text-muted small">提现渠道</label>
                            <div id="previewChannel">-</div>
                        </div>
                        <div class="col-md-6">
                            <label class="text-muted small">货币类型</label>
                            <div id="previewCurrency">-</div>
                        </div>
                        <div class="col-md-12">
                            <label class="text-muted small">提现金额</label>
                            <div class="fs-3 fw-bold text-success" id="previewAmount">-</div>
                        </div>
                        <div class="col-md-12">
                            <label class="text-muted small">收款账号</label>
                            <div class="fw-bold" id="previewAccount">-</div>
                        </div>
                        <div class="col-md-12">
                            <label class="text-muted small">备注</label>
                            <div id="previewRemark" class="text-muted">-</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>返回修改
                    </button>
                    <button type="button" class="btn btn-primary" onclick="confirmSubmit()">
                        <i class="bi bi-check-circle me-2"></i>确认提交
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedChannel = '';
        let currentType = 'DISTRIBUTOR';

        // 分销商数据
        const distributorData = [
            { id: 'D1001', name: '张明远', email: 'zhangmy@example.com', balance: 15680.50, withdrawable: 125800.00, currency: 'CNY' },
            { id: 'D1002', name: '李婷婷', email: 'ltt@partner.co', balance: 8520.00, withdrawable: 45600.00, currency: 'USD' },
            { id: 'D1003', name: '王大伟', email: 'wdw@travel.jp', balance: 256800, withdrawable: 1250000, currency: 'JPY' },
            { id: 'D1004', name: '陈思雨', email: 'chensy@sg-travel.com', balance: 3250.00, withdrawable: 18900.00, currency: 'USD' }
        ];

        // 业务员数据
        const salesmanData = [
            { id: 'S10001', name: '王小明', email: 'wangxm@example.com', balance: 420.00, withdrawable: 2340.00, currency: 'CNY', distributor: '张明远 (D1001)' },
            { id: 'S10002', name: '李小红', email: 'lixh@example.com', balance: 562.50, withdrawable: 3150.00, currency: 'CNY', distributor: '张明远 (D1001)' },
            { id: 'S10003', name: '张大伟', email: 'zdw@example.com', balance: 320.00, withdrawable: 1800.00, currency: 'CNY', distributor: '张明远 (D1001)' },
            { id: 'S10004', name: '刘芳芳', email: 'liuff@partner.co', balance: 225.00, withdrawable: 1200.00, currency: 'CNY', distributor: '李婷婷 (D1002)' },
            { id: 'S10005', name: '赵强', email: 'zhaoq@example.net', balance: 495.00, withdrawable: 2800.00, currency: 'CNY', distributor: '张明远 (D1001)' }
        ];

        function selectType(type) {
            const radio = type === 'DISTRIBUTOR' ? document.getElementById('typeDistributor') : document.getElementById('typeSalesman');
            radio.checked = true;
            switchType();
        }

        function switchType() {
            const typeRadio = document.querySelector('input[name="withdrawalType"]:checked');
            currentType = typeRadio ? typeRadio.value : 'DISTRIBUTOR';
            
            const select = document.getElementById('targetSelect');
            const label = document.getElementById('selectLabel');
            const nameLabel = document.getElementById('infoNameLabel');
            const confirmInfo = document.getElementById('confirmTypeInfo');
            const distributorFilterDiv = document.getElementById('distributorFilterDiv');
            const distributorFilter = document.getElementById('distributorFilter');
            
            if (!select) {
                console.error('targetSelect元素未找到');
                return;
            }
            
            // 清空选择
            select.innerHTML = '<option value="">请选择</option>';
            const targetInfo = document.getElementById('targetInfo');
            if (targetInfo) {
                targetInfo.style.display = 'none';
            }
            
            if (currentType === 'DISTRIBUTOR') {
                // 隐藏分销商筛选
                if (distributorFilterDiv) {
                    distributorFilterDiv.style.display = 'none';
                }
                // 移除required属性，避免表单验证错误
                if (distributorFilter) {
                    distributorFilter.removeAttribute('required');
                }
                
                if (label) label.textContent = '选择对象';
                if (nameLabel) nameLabel.textContent = '对象名称';
                if (confirmInfo) confirmInfo.textContent = '提现对象信息正确';
                
                // 填充分销商选项
                distributorData.forEach(item => {
                    const symbol = '$';
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.dataset.name = item.name;
                    option.dataset.email = item.email;
                    option.dataset.balance = item.balance;
                    option.dataset.withdrawable = item.withdrawable;
                    option.dataset.currency = item.currency;
                    option.textContent = `${item.name} (${item.id}) - 可提现: ${symbol}${item.withdrawable.toLocaleString()} | 待结算: ${symbol}${item.balance.toLocaleString()}`;
                    select.appendChild(option);
                });
            } else {
                // 显示分销商筛选
                if (distributorFilterDiv) {
                    distributorFilterDiv.style.display = 'block';
                }
                // 添加required属性
                if (distributorFilter) {
                    distributorFilter.setAttribute('required', 'required');
                }
                
                // 填充分销商筛选选项
                if (distributorFilter) {
                    distributorFilter.innerHTML = '<option value="">请选择分销商</option>';
                    distributorData.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.id;
                        option.textContent = `${item.name} (${item.id})`;
                        distributorFilter.appendChild(option);
                    });
                }
                
                if (label) label.textContent = '选择对象';
                if (nameLabel) nameLabel.textContent = '对象名称';
                if (confirmInfo) confirmInfo.textContent = '提现对象信息正确';
                
                // 填充业务员选项（初始显示全部）
                filterSalesmen();
            }
        }

        function filterSalesmen() {
            const select = document.getElementById('targetSelect');
            const distributorFilter = document.getElementById('distributorFilter');
            const selectedDistributorId = distributorFilter.value;
            
            // 清空当前选项
            select.innerHTML = '<option value="">请选择</option>';
            document.getElementById('targetInfo').style.display = 'none';
            
            // 如果没有选择分销商，不显示业务员
            if (!selectedDistributorId) {
                return;
            }
            
            // 根据筛选条件填充业务员
            salesmanData.forEach(item => {
                // 从distributor字段中提取ID（格式：张明远 (D1001)）
                const distributorIdMatch = item.distributor.match(/\(([^)]+)\)/);
                const itemDistributorId = distributorIdMatch ? distributorIdMatch[1] : '';
                if (itemDistributorId !== selectedDistributorId) {
                    return;
                }
                
                const symbol = '$';
                const option = document.createElement('option');
                option.value = item.id;
                option.dataset.name = item.name;
                option.dataset.email = item.email;
                option.dataset.balance = item.balance;
                option.dataset.withdrawable = item.withdrawable;
                option.dataset.currency = item.currency;
                option.dataset.distributor = item.distributor;
                option.textContent = `${item.name} (${item.id}) - 可提现: ${symbol}${item.withdrawable.toLocaleString()} | 待结算: ${symbol}${item.balance.toLocaleString()}`;
                select.appendChild(option);
            });
        }

        function selectChannel(channel, element) {
            // 移除其他选中状态
            document.querySelectorAll('.channel-option').forEach(el => el.classList.remove('selected'));
            // 添加当前选中状态
            element.classList.add('selected');
            selectedChannel = channel;
            document.getElementById('channel').value = channel;
            
            // 更新账号提示
            const accountInput = document.getElementById('accountNumber');
            switch(channel) {
                case 'ALIPAY':
                    accountInput.placeholder = '请输入支付宝账号（邮箱或手机号）';
                    break;
                case 'WECHAT':
                    accountInput.placeholder = '请输入微信号或绑定手机号';
                    break;
                case 'BANK':
                    accountInput.placeholder = '请输入银行卡号';
                    break;
                case 'PAYPAL':
                    accountInput.placeholder = '请输入PayPal账号（邮箱）';
                    break;
            }
        }

        function updateTargetInfo() {
            const select = document.getElementById('targetSelect');
            const option = select.options[select.selectedIndex];
            const infoDiv = document.getElementById('targetInfo');
            
            if (select.value) {
                document.getElementById('infoName').textContent = option.dataset.name;
                document.getElementById('infoEmail').textContent = option.dataset.email;
                
                const currency = option.dataset.currency;
                const balance = parseFloat(option.dataset.balance);
                const withdrawable = parseFloat(option.dataset.withdrawable);
                const symbol = '$';
                
                document.getElementById('infoWithdrawable').textContent = symbol + withdrawable.toLocaleString();
                document.getElementById('infoBalance').textContent = symbol + balance.toLocaleString();
                
                // 如果是业务员，显示所属分销商
                if (currentType === 'SALESMAN' && option.dataset.distributor) {
                    const infoRow = infoDiv.querySelector('.row');
                    if (!infoRow.querySelector('#infoDistributor')) {
                        const distributorCol = document.createElement('div');
                        distributorCol.className = 'col-md-12 mt-2';
                        distributorCol.id = 'infoDistributor';
                        distributorCol.innerHTML = '<small class="text-muted">所属分销商</small><div>' + option.dataset.distributor + '</div>';
                        infoRow.appendChild(distributorCol);
                    } else {
                        document.getElementById('infoDistributor').querySelector('div').textContent = option.dataset.distributor;
                    }
                } else {
                    const distributorInfo = document.getElementById('infoDistributor');
                    if (distributorInfo) {
                        distributorInfo.remove();
                    }
                }
                
                infoDiv.style.display = 'block';
            } else {
                infoDiv.style.display = 'none';
            }
        }

        function updateAmountPreview() {
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const preview = document.getElementById('amountPreview');
            
            if (amount > 0) {
                preview.innerHTML = `<span class="amount-usd">$${amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>`;
            } else {
                preview.innerHTML = '<span class="text-muted">$0.00</span>';
            }
        }

        function submitForm(event) {
            // 阻止表单默认提交
            if (event) {
                event.preventDefault();
            }
            
            try {
                // 如果是分销商类型，确保分销商筛选器不是必填的
                if (currentType === 'DISTRIBUTOR') {
                    const distributorFilter = document.getElementById('distributorFilter');
                    if (distributorFilter) {
                        distributorFilter.removeAttribute('required');
                    }
                }
                
                const target = document.getElementById('targetSelect');
                const channel = document.getElementById('channel').value;
                const currency = document.getElementById('currency').value;
                const amount = document.getElementById('amount').value;
                const account = document.getElementById('accountNumber').value;
                const remark = document.getElementById('remark').value;
                
                // 如果是业务员类型，检查是否选择了分销商
                if (currentType === 'SALESMAN') {
                    const distributorFilter = document.getElementById('distributorFilter');
                    if (!distributorFilter || !distributorFilter.value) {
                        alert('请先选择分销商');
                        return false;
                    }
                }
                
                if (!channel) {
                    alert('请选择提现渠道');
                    return false;
                }
                
                if (!target || !target.value) {
                    alert('请选择提现对象');
                    return false;
                }
                
                if (!amount || parseFloat(amount) <= 0) {
                    alert('请输入有效的提现金额');
                    return false;
                }
                
                if (!account) {
                    alert('请输入收款账号');
                    return false;
                }
                
                // 填充预览信息
                const targetName = target.options[target.selectedIndex].dataset.name;
                const typeName = currentType === 'DISTRIBUTOR' ? '分销商' : '业务员';
                
                const channelNames = {
                    'ALIPAY': '支付宝',
                    'WECHAT': '微信',
                    'BANK': '银行转账',
                    'PAYPAL': 'PayPal'
                };
                
                const channelIcons = {
                    'ALIPAY': '<i class="bi bi-alipay"></i>',
                    'WECHAT': '<i class="bi bi-wechat"></i>',
                    'BANK': '<i class="bi bi-bank"></i>',
                    'PAYPAL': '<i class="bi bi-paypal"></i>'
                };
                
                // 如果是业务员，显示所属分销商
                let targetDisplay = targetName;
                if (currentType === 'SALESMAN') {
                    const distributorFilter = document.getElementById('distributorFilter');
                    if (distributorFilter && distributorFilter.value) {
                        const distributorOption = distributorFilter.options[distributorFilter.selectedIndex];
                        targetDisplay = `${targetName}（所属分销商：${distributorOption.textContent}）`;
                    }
                }
                
                document.getElementById('previewType').textContent = typeName;
                document.getElementById('previewTarget').textContent = targetDisplay;
                document.getElementById('previewChannel').innerHTML = `<span class="badge bg-primary">${channelIcons[channel]} ${channelNames[channel]}</span>`;
                document.getElementById('previewCurrency').innerHTML = `<span class="badge bg-info">${currency} - 美元</span>`;
                document.getElementById('previewAmount').textContent = '$' + parseFloat(amount).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                document.getElementById('previewAccount').textContent = account;
                document.getElementById('previewRemark').textContent = remark || '无';
                
                // 显示预览弹窗
                const previewModal = document.getElementById('previewModal');
                if (!previewModal) {
                    alert('预览弹窗未找到，请刷新页面重试');
                    return false;
                }
                
                const modal = new bootstrap.Modal(previewModal);
                modal.show();
                
            } catch (error) {
                console.error('提交表单时出错:', error);
                alert('提交时发生错误：' + error.message);
            }
            
            return false;
        }

        function confirmSubmit() {
            // 关闭预览弹窗
            bootstrap.Modal.getInstance(document.getElementById('previewModal')).hide();
            
            // 显示成功提示
            alert('提现录入成功！已触发返现操作。\n\n（这是一个静态演示页面）');
            window.location.href = 'withdrawal-list.html';
        }

        // 初始化
        function initPage() {
            switchType();
            updateAmountPreview();
        }
        
        // 确保DOM加载完成后再初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initPage);
        } else {
            // DOM已经加载完成，直接执行
            initPage();
        }
    </script>
</body>
</html>

